---
import PageLayout from "../layouts/page-layout.astro";
import DownloadButtons from "../components/download-buttons.astro";
---

<PageLayout>
  <div class="mx-auto p-4 lg:w-4/5">
    <div>
      <div class="flex justify-between align-middle mb-2">
        <h2 class="text-2xl font-semibold text-brandRed py-2">MS-Items</h2>
        <DownloadButtons />
      </div>
      <div class="overflow-y-auto max-h-[1000px]">
        <table
          id="tabulator-table"
          class="w-full text-brandBrown table-fixed shadow-md border lg:leading-7 text-sm lg:text-base data-table"
        >
        </table>
      </div>
    </div>
    <script>
      import { TabulatorFull as Tabulator } from "tabulator-tables";
      import "tabulator-tables/dist/css/tabulator_materialize.min.css";
      import data from "../content/data/ms_items.json";
      import { jsonpathLookup } from "../lib/tabulator-utils.js";
      import NavLink from "../components/nav-link.astro";

      var tabledata = [...Object.values(data)];

      var table = new Tabulator("#tabulator-table", {
        headerFilterLiveFilterDelay: 600,
        height: 900,
        data: tabledata,
        layout: "fitColumns",
        responsiveLayout: "collapse",
        columns: [
          {
            title: "ID",
            field: "view_label",
            formatter: "textarea",
          },
          {
            title: "Werk",
            field: "title_work",
            mutator: jsonpathLookup,
            mutatorParams: {
              path: "$[*].title",
              separator: "; ",
            },
            headerFilter: "input",
          },
          /*  {
            title: "Autor",
            field: "title_work",
            mutator: jsonpathLookup,
            mutatorParams: {
              path: "$[*].author[*].name",
              separator: "; ",
            },
            headerFilter: "input",
          }, */

          {
            title: "Dekoration",
            field: "decoration",
            mutator: jsonpathLookup,
            mutatorParams: { path: "$[*].value" },
            headerFilter: "input",
          },
          {
            title: "Handschrift",
            field: "manuscript",
            mutator: jsonpathLookup,
            mutatorParams: {
              path: "$[*].shelfmark[*].value",
              separator: "; ",
            },
            headerFilter: "input",
          },
        ],
      });

      //trigger download of data.csv file
      document
        .getElementById("download-csv")!
        .addEventListener("click", function () {
          table.download("csv", "data.csv");
        });

      //trigger download of data.json file
      document
        .getElementById("download-json")!
        .addEventListener("click", function () {
          table.download("json", "data.json");
        });

      //trigger download of data.html file
      document
        .getElementById("download-html")!
        .addEventListener("click", function () {
          table.download("html", "data.html", { style: true });
        });

      // event listeners set:
      // href to the work detail view page
      table.on("rowClick", function (e, row) {
        var data = row.getData();
        var url = `msitems/${data["hit_id"]}`;
        window.open(url, "_self");
      });
      table.on("cellClick", function (e, cell) {
        const data = cell.getData();
        const url = ``;
      });
    </script>
  </div></PageLayout
>
