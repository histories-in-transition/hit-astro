---
import PageLayout from "../layouts/page-layout.astro";
import TableHead from "../components/table-head.astro";
import TabulatorTable from "@/components/tabulator-table.jsx";
import { worksTableConfig } from "@/lib/tabulator-table-configs.js";
import works from "@/content/data/works.json";
import msitems from "@/content/data/ms_items.json";

import MapLeaflet from "@/components/map-leaflet.jsx";
import { processMsItemsData } from "@/lib/make-geojson.js";
const geoJsonData = processMsItemsData(msitems);

// Transform data and prepare columns for Tabulator Table
const tableData = worksTableConfig.transformData(works);
const columns = worksTableConfig.getColumns();
const rowClickConfig = worksTableConfig.getRowClickConfig;
---

<PageLayout title="works">
	<TableHead title="Werke">
		<MapLeaflet client:only="react" geoJsonData={geoJsonData} />
		<TabulatorTable
			client:only="react"
			data={tableData}
			columns={columns}
			tableId="work-detail-table"
			options={{
				paginationSize: 25,
				responsiveLayout: "hide",
				dataTree: true,
				dataTreeStartExpanded: false,
			}}
			downloadTitle="hit_handschriften"
			rowClickConfig={rowClickConfig}
			updateMapOnFilter={true}
			mapIdField="hit_id"
		/>
	</TableHead>
</PageLayout>
