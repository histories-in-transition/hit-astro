---
import PageLayout from "../layouts/page-layout.astro";
import TableHead from "../components/table-head.astro";
import TabulatorTable from "@/components/tabulator-table.svelte";
import { msItemsTableConfig } from "@/lib/tabulator-table-configs.js";
import msItems from "@/content/data/ms_items.json";
import type { MsItem } from "@/types/index.ts";

import MapLeaflet from "@/components/map-leaflet.svelte";
import { processMsItemsData } from "@/lib/make-geojson.ts";
const geoJsonData = processMsItemsData(msItems as MsItem[]);

// Transform data and prepare columns for Tabulator Table
const tableData = msItemsTableConfig.transformData(msItems);
const columns = msItemsTableConfig.getColumns();
const rowClickConfig = msItemsTableConfig.getRowClickConfig;
---

<PageLayout title="msitems">
	<TableHead
		title="MS Elemente"
		definition="Manuskriptelement bezeichnet ein einzelnes Werk oder Element innerhalb des Inhalts einer Handschrift."
	>
		<TabulatorTable
			client:only="svelte"
			data={tableData}
			columns={columns}
			tableId="msItems-table"
			options={{
				paginationSize: 25,
				responsiveLayout: "collapse", // need to show three columns, only the first two fit with 'hide'
				responsiveLayoutCollapseStartOpen: false,
			}}
			downloadTitle="hit_msitems"
			rowClickConfig={rowClickConfig}
			updateMapOnFilter={true}
			mapIdField="hit_id"
		>
			<MapLeaflet slot="map" client:only="svelte" geoJsonData={geoJsonData} />
		</TabulatorTable>
	</TableHead>
</PageLayout>
