---
import PageLayout from "../layouts/page-layout.astro";
import TableHead from "../components/table-head.astro";
import TabulatorTable from "@/components/tabulator-table.svelte";
import { manuscriptsTableConfig } from "@/lib/tabulator-table-configs.js";
import manuscripts from "@/content/data/manuscripts.json";
import type { Manuscript } from "@/types/index.ts";

import MapLeaflet from "@/components/map-leaflet.svelte";
import { processMSData } from "@/lib/make-geojson.ts";
const geoJsonData = processMSData(manuscripts as Manuscript[]);

// Transform data and prepare columns for Tabulator Table
const tableData = manuscriptsTableConfig.transformData(manuscripts);
const columns = manuscriptsTableConfig.getColumns();
const rowClickConfig = manuscriptsTableConfig.getRowClickConfig;
---

<PageLayout title="manuscripts">
	<TableHead title="Handschriften">
		<MapLeaflet client:only="svelte" geoJsonData={geoJsonData} />
		<TabulatorTable
			client:only="svelte"
			data={tableData}
			columns={columns}
			tableId="work-detail-table"
			downloadTitle="hit_handschriften"
			rowClickConfig={rowClickConfig}
			updateMapOnFilter={true}
			mapIdField="hit_id"
		/>
	</TableHead>
</PageLayout>
